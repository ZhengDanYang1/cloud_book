# 第4节：服务网关

网关可分为硬件网关和软件系统的网关。硬件网关指网间连接器或协议转换器，用于网络互联的关卡；软件系统的网关，即服务网关，用于系统/服务之间的交互、提升客户端与后台之间的通信质量和效率。

移动互联网和物联网相关技术的成熟促使了客户端系统入口的多元化发展，为了使云原生应用满足不同智能终端的高效接入、调用的需求，服务网关在不同场景中扮演了至关重要的角色。

随着近些年云原生技术的不断落地，越来越多的应用开发模式向微服务靠拢。从云原生应用开发的角度观察，每一层业务应用和基础服务都需要建立调用、依赖的关系，大量的非业务功能使得各种业务应用和基础服务的颗粒度增大，客户端与后台之间的交互显得更加错综复杂。为了解决此痛点，服务网关应用而生。它提供了与传统意义上硬件网关类似的核心功能：路由转发与过滤转换。随着微服务框架的落地场景增多、业务应用量的不断增大，更多的非业务功能需要被集中在网关层进行处理，进而除了核心功能外又衍生出一些扩展功能：统一接入、流量管控、安全防护、业务隔离等。大量的非业务功能被沉淀至网关层后，业务功能与系统之间的松耦合性使得开发人员可以更好地集中精力在业务开发，进而实现高效迭代、加速业务创新的目的。从分布式应用的开发上讲，服务网关还需要解决跨地域请求的问题，前后端分离架构中的API调用、管理便是其中的痛点之一。API网关服务在后续中间件典型服务章节会谈及到。[[1]](#_msocom_1) 

服务网关是一个服务器，是系统的唯一入口。从面向对象设计的角度看，它与外观模式类似。它可能还具有其它职责，如身份验证、监控、负载均衡、缓存、请求分片与管理、静态响应处理。服务网关方式的核心要点是，所有的客户端和消费端都通过统一的网关接入微服务，在网关层处理所有的非业务功能。通常，网关也是提供REST/HTTP的访问API。服务端通过API-GW注册和管理服务。

服务网关负责请求转发、合成和协议转换。所有来自客户端的请求都要先经过服务网关，然后路由这些请求到对应的微服务。服务网关将经常通过调用多个微服务来处理一个请求以及聚合多个服务的结果。它可以在web协议与内部使用的非Web友好型协议间进行转换，如HTTP协议、WebSocket协议。 服务网关可以提供给客户端一个定制化的API。它暴露一个粗粒度API给移动客户端。以产品最终页这个使用场景为例。服务网关提供一个服务提供点，使得移动客户端可以在一个请求中检索到产品最终页的全部数据。服务网关通过调用多个服务来处理这一个请求并返回结果，涉及产品信息、推荐、评论等。

对于大多数微服务基础的应用，实现一个服务网关都是有意义的，它就像是进入系统的一个服务提供点，在应用中，服务网关具有几个比较重要的优点，使得微服务的部署及应用更加便捷：

1、采用服务网关可以与微服务注册中心连接，实现微服务无感知动态扩容。

2、服务网关对于无法访问的服务，可以做到自动熔断，无需人工参与。

3、服务网关可以方便的实现蓝绿部署，金丝雀发布或A/B发布。

4、服务网关做为系统统一入口，我们可以将各个微服务公共功能放在服务网关中实现，以尽可能减少各服务的职责。

5、帮助实现客户端的负载均衡策略。

------



 [[1]](#_msoanchor_1)逻辑：从网关出发、结合云原生应用的特点，给出服务网关的需求-解决的问题，引出API网关具体中间件服务的论述。相对较为抽象，如想增加字数或者具体细节，可添加上一版本服务网关的几个具体优点。